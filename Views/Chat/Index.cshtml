@{
    ViewData["Title"] = "Broker Dealer Bot - How can I help you?";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <link rel="icon" href="/images/bd-buddy.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link to the external CSS file -->
    <link href="~/css/site.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container text-center mt-5">
        <img src="/images/bd-buddy.png" alt="BD Buddy" class="mb-3">

        <div class="chat-container">
            <div id="chat-window">
                @if (ViewData["AssistantResponse"] != null)
                {
                    <div class="chat-message bd-buddy">
                        <strong>BD Buddy:</strong> @Html.Raw(ViewData["AssistantResponse"].ToString())
                    </div>
                }
            </div>

            <form id="chat-form" asp-action="AskAssistant" method="post" class="mt-3 d-flex">
                <input type="text" id="user-query" name="userQuery" class="form-control me-2" placeholder="How Can I Help You ? " />
                <button type="submit" class="btn">Send</button>
            </form>
        </div>
    </div>

    <script>
        $(document).ready(function () {
        @if (ViewData["AssistantResponse"] != null)
        {
            <text>
                    $('#chat-window').append('<div class="chat-message bd-buddy"><strong>BD Buddy:</strong> @Html.Raw(ViewData["AssistantResponse"].ToString())</div>');
            </text>
        }

                $('#chat-form').submit(function (event) {
                    event.preventDefault();
                    const userInput = $('#user-query').val().trim();
                    if (userInput === '') return;

                    $('#chat-window').append(`<div class="chat-message user"><strong>You:</strong> ${userInput}</div>`);
                    $('#user-query').val('');

                    $.post('/Chat/AskAssistant', { userQuery: userInput }, function (data) {
                        $('#chat-window').append(`<div class="chat-message bd-buddy"><strong>BD Buddy:</strong> ${data.response}</div>`);
                        $('#chat-window').scrollTop($('#chat-window')[0].scrollHeight);
                    });
                });
        });
    </script>
</body>
</html>
